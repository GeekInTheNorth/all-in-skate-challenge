@using AllInSkateChallenge.Features.Skater;
@model AllInSkateChallenge.Features.Framework.Models.PageViewModel<AllInSkateChallenge.Features.Skater.SkateLog.SkaterLogViewModel>

@{
    Layout = "_PageViewModelLayout";
}

<div class="row">
    <div class="col-xl-12">
        <button type="button" class="btn btn-primary js-add-mileage-entry mt-3 mb-3">+ Create New Mileage Entry</button>
        @if (Model.IsStravaUser && Model.HasStravaImports)
        {
            <a asp-controller="StravaImport" asp-action="Index" class="btn btn-strava"></a>
        }
    </div>
</div>

<table class="table table-striped">
    <thead class="thead-dark">
        <tr>
            <th scope="col">Logged</th>
            <th scope="col">Miles</th>
            @if (Model.IsStravaUser)
            {
                <th scope="col">Source</th>
            }
            <th scope="col" class="js-action-delete-column">Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var entry in Model.Content.Entries)
        {
            <tr class="js-mileage-entry-row" data-entry-id="@entry.SkateLogEntryId">
                <td class="align-middle">@entry.Logged.ToString("dd/MM/yyyy HH:mm")</td>
                <td class="align-middle">@entry.DistanceInMiles.ToString("F2") miles</td>
                @if (Model.IsStravaUser)
                {
                    <td class="align-middle">@(string.IsNullOrWhiteSpace(entry.StravaId) ? "Manual" : "Strava")</td>
                }
                <td class="align-middle js-action-delete-column">
                    <button type="button" class="btn btn-danger js-delete-mileage-entry" data-entry-id="@entry.SkateLogEntryId">Delete</button>
                </td>
            </tr>
        }
    </tbody>
</table>

<div class="modal fade" id="deleteEntryModal" tabindex="-1" role="dialog" aria-labelledby="deleteEntryLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteEntryLabel">Delete Mileage Entry</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this mileage log entry?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-danger js-confirm-delete-mileage-entry">Delete</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addEntryModal" tabindex="-1" role="dialog" aria-labelledby="saveEntryLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="saveEntryLabel">Create Mileage Entry</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form method="post" asp-controller="SkaterLog" asp-action="Index" asp-antiforgery="true">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="distanceUnit">Miles or Kilometres?</label>
                        @Html.DropDownList(nameof(INewSkaterLogEntry.DistanceUnit), new SelectList(Enum.GetValues(typeof(DistanceUnit))), new { @class = "form-control", aria_describedby = "distanceUnitHelp" })
                        <small id="distanceUnitHelp" class="form-text text-muted">Distance can be logged in miles or kilometres, but will be converted into miles.</small>
                    </div>
                    <div class="form-group">
                        <label for="distance">Distance this session</label>
                        @Html.TextBox(nameof(INewSkaterLogEntry.Distance), Model.Content.Distance, new { @type = "number", @class = "form-control", aria_describedby = "distanceHelp", step = "0.01", min = "0", max = "1000" })
                        <small id="distanceHelp" class="form-text text-muted">Partial miles or kilometres can be entered by typing a decimal value e.g. 4.5.</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary js-confirm-create-mileage-entry">Create</button>
                </div>
            </form>
        </div>
    </div>
</div>